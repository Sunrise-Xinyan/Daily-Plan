name: Build Android APK

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
  
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
  
    - name: â˜• è®¾ç½® Java
      uses: actions/setup-java@v3
      with:
        distribution: 'zulu'
        java-version: '11'
  
    - name: ğŸ¯ è®¾ç½® Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.10.6'
        channel: 'stable'
  
    - name: ğŸ“¦ è·å–ä¾èµ–
      run: flutter pub get
  
    - name: ğŸ”¨ æ„å»º APK
      run: flutter build apk --release
  
    - name: ğŸ“¤ ä¸Šä¼  APK
      uses: actions/upload-artifact@v3
      with:
        name: app-release
        path: build/app/outputs/flutter-apk/app-release.apk
  
    - name: ğŸ‰ åˆ›å»º Release
      if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v1.0.${{ github.run_number }}
        name: æ—¥å¸¸è®¡åˆ’ v1.0.${{ github.run_number }}
        files: build/app/outputs/flutter-apk/app-release.apk
        body: |
          ## ğŸ“± æ—¥å¸¸è®¡åˆ’åº”ç”¨ APK
        
          ### ä¸‹è½½å®‰è£…
          1. ç‚¹å‡»ä¸‹æ–¹ Assets ä¸­çš„ `app-release.apk` ä¸‹è½½
          2. ä¼ è¾“åˆ°æ‰‹æœº
          3. ç‚¹å‡»å®‰è£…ï¼ˆå…è®¸å®‰è£…æœªçŸ¥åº”ç”¨ï¼‰
        
          ### åŠŸèƒ½ç‰¹æ€§
          - âœ… ä»Šæ—¥è®¡åˆ’ç»Ÿè®¡
          - âœ… è¿åŠ¨è®°å½•ç®¡ç†
          - âœ… å­¦ä¹ è®°å½•ç®¡ç†
          - âœ… æœ¬åœ°æ•°æ®å­˜å‚¨
        
          ### ç³»ç»Ÿè¦æ±‚
          - Android 5.0 (API 21) æˆ–æ›´é«˜ç‰ˆæœ¬
        
          ### æ–‡ä»¶å¤§å°
          - çº¦ 20-25 MB
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
